{# view projects modal ("Manage" link) #}

<div class="modal-dialog modal-lg">
  <div class="modal-content">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <a name="top"></a>
      <h3 class="modal-title" id="dataviewTitle">Manage Projects and Dataviews</h3>
      <p class="bg-info"><a href="#listprojects">List Projects</a> | <a href="#">Create Project</a> | <a href="#listdataviews">List Dataviews</a> | <a href="#">Create Dataview</a></p>
    </div>
    <div class="modal-body">
      <a name="listprojects"></a>
      {% if projects %}
      <table class="table table-hover">
        <caption>All viz projects for user <strong>{{ user.get_username }}</strong> are listed below. (<a href="#top">back to top</a>)</caption>
        <thead>
          <tr>
            <th>Project Name</ht>
            <th>Description</th>
            <th>Public?</th>
            <th colspan="4"></th>
          </tr>
        </thead>
        <tbody>
        {% for project in projects %}
        <tr id="{{ project.project_name }}">
          <td>{{ project.project_name }}</td>
          <td>{{ project.project_description }}</td>
          <td>{% if project.public %}<span class="glyphicon glyphicon-ok" aria-hidden="true"></span>{% endif %}</td>
          <td><button type="button" id="metadata" class="btn btn-primary">Metadata</button></td>
          <td><button type="button" id="layers" class="btn btn-info">Layers</button></td>
          <td><a href="{% url 'projectview' webargs=project.project_name %}"><button type="button" class="btn btn-success">View</button></a></td>
          <td><button type="button" id="edit" class="btn btn-danger">Edit</button></td>
        </tr>
        <tr id="metadata_{{ project.project_name }}" style="display:none;">
          <td colspan="1"><strong><small>resolutions</small></strong> {{ project.scalinglevels }}</td> 
          <td colspan="2"><strong><small>(x,y,z) bounds</small></strong> ({{ project.xoffset }},{{ project.ximagesize }}), ({{ project.yoffset }}, {{ project.yimagesize }}), ({{ project.zoffset }}, {{ project.zimagesize }})</td>
          <td colspan="2"><strong><small>time bounds</small></strong> ({{ project.starttime }}, {{ project.endtime }})</td>
        </tr>
        <tr id="layers_{{ project.project_name }}" style="display:none;">
          <td colspan="7">Layers</td> 
        </tr>
        {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p class="bg-danger">User {{ user.get_username }} has no viz projects! <a href="#">Create one?</a></p>
      {% endif %}
      <a name="listdataviews"></a>
      {% if dataviews %}
      <table class="table table-hover">
        <caption>All dataviews for user <strong>{{ user.get_username }}</strong> are listed below. (<a href="#top">back to top</a>)</caption>
        <tbody>
        {% for dv in dataviews %}
        <tr>
          <td>{{ dv.name }} (<em>{{ dv.token }}</em>)</td>
          <td>{{ dv.desc }}</td>
          <td>{{ dv.public }}</td>
          <td><a href="#">Items</a></td>
          <td><a href="{% url 'dataview' webargs=dv.token %}">View</a></td>
          <td><a href="#">Edit</a></td>
        </tr>
        {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p class="bg-danger">User {{ user.get_username }} has no dataviews! <a href="#">Create one?</a></p>
      {% endif %}
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
    </div>
   </div>
 </div>

{# end view projects modal #}

<script>
  $( "button#metadata" ).click(function() {
    var id = $(this).parent().parent().attr('id');
    console.log(id);
    $( "#metadata_" + id ).toggle();  
  });
  $( "button#layers" ).click(function() {
    var id = $(this).parent().parent().attr('id');
    // todo run queries for layer separately, so we don't overwhelm the DB 
    console.log(id);
    $( "#layers_" + id ).toggle();  
  });
  $( "button#edit" ).click(function() {
    $( "#remoteModal" ).load("http://google.com");
    $( "#remoteModal" ).modal('show');
  });
</script>
